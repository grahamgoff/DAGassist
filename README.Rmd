---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, 
  comment = "#>",
  fig.path = "man/figures/README-", out.width = "100%"
)

#devtools::load_all(quiet = TRUE)
library(ggplot2)
library(dotwhisker)
library(fixest)
```

```{r col, include=FALSE}
# make knitr treat output as plain text to pass r-comd-check
options(
  DAGassist.color = FALSE,  # we'll wire this up below
  crayon.enabled = FALSE
)
Sys.setenv(NO_COLOR = "1")
```

```{r dev-load, include=FALSE}
# Try loading from source when rendering inside the package repo
if (requireNamespace("devtools", quietly = TRUE) && file.exists("DESCRIPTION")) {
  try(devtools::load_all(".", quiet = TRUE), silent = TRUE)
}

# If not loaded from source, attach installed build (CRAN/GitHub)
if (!"DAGassist" %in% loadedNamespaces() && requireNamespace("DAGassist", quietly = TRUE)) {
  library(DAGassist)
}

# Feature gates (after load attempt)
has_dotwhisker <- tryCatch({
  exists(".report_dotwhisker", envir = asNamespace("DAGassist"), inherits = FALSE)
}, error = function(e) FALSE)
```

# DAGassist

<!-- badges: start -->
[![R-CMD-check](https://github.com/grahamgoff/DAGassist/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/grahamgoff/DAGassist/actions/workflows/R-CMD-check.yaml)
[![pages-build-deployment](https://github.com/grahamgoff/DAGassist/actions/workflows/pages/pages-build-deployment/badge.svg)](https://github.com/grahamgoff/DAGassist/actions/workflows/pages/pages-build-deployment)
[![CRAN status](https://www.r-pkg.org/badges/version/DAGassist)](https://cran.r-project.org/package=DAGassist)

<!-- badges: end -->

**An all-in-one DAG-driven robustness check.**
Classify variables by causal role, compute the smallest and largest permissible back-door adjustment sets, and compare the significance of models.

See the [Quick Tour](https://grahamgoff.github.io/DAGassist/articles/quick-tour.html) vignette for a 10 minute start-to-finish guide on how to use `DAGassist` to identify causal roles, create reports, and interpret the results.

See the [Making Reports](https://grahamgoff.github.io/DAGassist/articles/making-reports.html) vignette for details on producing publication-quality `DAGassist` reports in `LaTex`, `Word`, `Excel`, and `plain text`. 

See the [Parameter Guide](https://grahamgoff.github.io/DAGassist/articles/get-started.html) vignette for examples of how to get the most out of `DAGassist`. 

See the [Supported Models](https://grahamgoff.github.io/DAGassist/articles/compatability.html) vignette for documentation on what engines `DAGassist` supports.

See the [Ecosystem Guide]("https://grahamgoff.github.io/DAGassist/articles/ecosystem.html") for how `DAGassist` fits in the R DAG ecosystemâ€”and a diagram of the packages it integrates with.

## Installation

You can install `DAGassist` with:
```{r cran, eval = FALSE}
install.packages("DAGassist")
library(DAGassist) 
```

Or you can install the development version from GitHub with:

```{r install, eval = FALSE}
# install.packages("devtools")
devtools::install_github("grahamgoff/DAGassist")
```

```{r ex-dag, include=FALSE}
library(dagitty)
library(ggdag)

dag_model <- dagify(
  Y ~ X + M + Z + A + B,
  X ~ Z,
  C ~ X + Y,
  M ~ X,
  exposure = "X",
  outcome  = "Y"
)

set.seed(42)
n <- 2000

#exogenous variables
A <- rnorm(n, 0, 1)
B <- rnorm(n, 0, 1)
Z <- rnorm(n, 0, 1)

#structural equations
# X ~ Z
beta_zx <- 0.8
X <- beta_zx * Z + rnorm(n, 0, 1)

# M ~ X
beta_xm <- 0.9
M <- beta_xm * X + rnorm(n, 0, 1)

# Y ~ X + M + Z + A + B
bX <- 0.7; bM <- 0.6; bZ <- 0.3; bA <- 0.2; bB <- -0.1
Y <- bX*X + bM*M + bZ*Z + bA*A + bB*B + rnorm(n, 0, 1)

# C ~ X + Y 
bXC <- 0.5; bYC <- 0.4
C <- bXC*X + bYC*Y + rnorm(n, 0, 1)

df <- data.frame(A, B, Z, X, M, Y, C)
```

## Example

Simply provide a `dagitty()` object and a regression call and `DAGassist` will create a report classifying variables by causal role, and compare the specified regression to minimal and canonical models. 

```{r run}
DAGassist::DAGassist(dag = dag_model, 
          formula = feols(Y ~ X + M + C + Z + A + B, data = df))

# note: this example uses a test DAG and dataset, which was created
# silently for the sake of brevity.
```

Optionally, users can generate visual output via dotwhisker plots:

```{r dotwhisker, eval=has_dotwhisker}
DAGassist::DAGassist(dag = dag_model,
          formula = feols(Y ~ X + M + C + Z + A + B, data = df),
          type = "dotwhisker")
```
