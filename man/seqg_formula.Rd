% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/seqg_formula.R
\name{seqg_formula}
\alias{seqg_formula}
\title{Build a DirectEffects::sequential_g() formula from a DAG (and optionally a base model formula)}
\usage{
seqg_formula(
  dag,
  formula = NULL,
  data = NULL,
  exposure = NULL,
  outcome = NULL,
  m = NULL,
  x = NULL,
  z = NULL,
  include_descendants = FALSE,
  fe = NULL,
  fe_as_factor = TRUE,
  drop_fe_collinear = TRUE,
  strict_rhs = TRUE,
  return_parts = TRUE
)
}
\arguments{
\item{dag}{A \code{dagitty} object (or a character DAGitty string).}

\item{formula}{Optional base formula (or an engine call like \code{fixest::feols(...)}).
If supplied, the function uses its RHS to define candidate covariates and to
pick up fixed-effects/grouping variables (which can be added to X).}

\item{data}{Optional data.frame. Used to (i) drop terms that do not exist in the data,
and (ii) optionally drop covariates collinear with fixed effects (important for seqg stability).}

\item{exposure, outcome}{Optional. If missing, inferred from \code{dagitty::exposures()} / \code{dagitty::outcomes()}.}

\item{m, x, z}{Optional character vectors overriding inferred mediator (M), baseline (X),
and intermediate (Z) terms.}

\item{include_descendants}{Logical; if TRUE, allow descendants of mediators to be included in M
(conservatively restricted to descendants that remain ancestors of Y and descendants of A).}

\item{fe}{Optional character vector of FE/grouping variables to include in X (merged with any extracted from \code{formula}).}

\item{fe_as_factor}{Logical; if TRUE, wraps bare FE names as \code{factor(FE)} (only when FE exists in \code{data}).}

\item{drop_fe_collinear}{Logical; if TRUE and \code{data} is provided, drop any single-variable term
that is constant within an FE group (DirectEffects is less forgiving than fixest here).}

\item{strict_rhs}{Logical; if TRUE and \code{formula} is provided, X is drawn only from RHS terms in \code{formula}.
If FALSE, X is drawn from the DAG node set (pre-treatment ancestors) even if not in \code{formula}.}

\item{return_parts}{Logical; if TRUE, returns a list with components and metadata; otherwise returns just the formula.}
}
\value{
A formula (or a list with \verb{$formula}, \verb{$x}, \verb{$z}, \verb{$m}, \verb{$fe}, \verb{$dropped_fe}).
}
\description{
Returns a formula of the form \code{Y ~ A + X | Z | M} required by
\code{\link[DirectEffects:sequential_g]{DirectEffects::sequential_g()}}, where:
\itemize{
\item \code{A} is the treatment (exposure),
\item \code{X} are baseline covariates,
\item \code{Z} are intermediate (post-treatment) covariates affected by A that affect both M and Y,
\item \code{M} are mediators (blip-down model terms).
}

If \code{formula} is provided, \code{X} is (by default) constrained to the RHS terms that
appear in that base formula (mirroring DAGassistâ€™s current ACDE construction).
}
